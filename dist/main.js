!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.JSR=t()}(this,function(){"use strict";const e={};function t(t,i,s){return!e[t]&&(e[t]=s,e[t](),setTimeout(()=>{e[t]=!1},i),!0)}function i(e,t,i){e.addEventListener(t,i)}function s(e,t,r){e instanceof Array?e.forEach(e=>{e instanceof Array?s(e,t,r):i(e,t,r)}):i(e,t,r)}function r(e){const t=e.toString().split(".");return t[1]?t[1].length:0}function n(e){const t=this.config.min;return(e-t)/(this.config.max-t)}function o(e){const t=this.config.min,i=this.config.max;return function(e){const t=this.config.step,i=Math.pow(10,this.stepDecimals);return e=Math.round(e/t)*t,Math.round(e*i)/i}.call(this,e=(i-t)*e+t)}var l={name:"core",Klass:class{constructor(){this.logger=null,this.config={min:0,max:0,step:0},this.modules={},this.values=[],this.valueInMove=[],this.stepRatio=0,this.stepRatioDecimals=0}_setValue(e,t=null,i=!1){if(!this.config.enabled)return null;t=null===t?function(e){let t=1,i=0;return this.values.forEach((s,r)=>{const n=Math.abs(s-e);n<t&&(i=r,t=n)}),i}.call(this,e):parseInt(t),i&&(e=this.valueInMove[t]+e),null!==this.limit.min&&e<this.limit.min&&(e=this.limit.min),null!==this.limit.max&&e>this.limit.max&&(e=this.limit.max),void 0!==this.values[t-1]&&e<this.values[t-1]&&(e=this.values[t-1]),void 0!==this.values[t+1]&&e>this.values[t+1]&&(e=this.values[t+1]);const s=function(e){const t=this.stepRatio,i=Math.pow(10,this.stepRatioDecimals);return e=Math.round(e/t)*t,Math.round(e*i)/i}.call(this,e);s!==this.values[t]&&(this.values[t]=s,this.modules.renderer.setSliderValue(s,t),this.modules.eventizer.trigger("core/value:update",t,o.call(this,s),s))}_bindEvents(){const e=this.modules.eventizer;e.register("view/slider:mousedown",(e,t)=>{this.logger.debug("JSR: Slider mousedown."),this.logger.debug(e),t.forEach(e=>{this.valueInMove[e]=this.values[e]})}),e.register("view/slider:mousemove",(e,i,s)=>{t("slider-mousemove",10,()=>{this.logger.debug("JSR: Slider mousemove."),this.logger.debug(e),this._setValue(s,i,!0)})}),e.register("view/slider:mouseup",e=>{this.logger.debug("JSR: Slider mouseup."),this.logger.debug(e)}),e.register("view/rail:click",(e,t)=>{this.logger.debug("JSR: Rail clicked."),this.logger.debug(e),this._setValue(t)}),e.register("view/root:arrow",(e,t,i)=>{const s=this.values[t]+(e.shiftKey?.05:e.ctrlKey?10*this.stepRatio:this.stepRatio)*i;this._setValue(s,t)}),e.register("view/bar:mousedown",(e,t)=>{this.logger.debug("JSR: Bar mousedown."),this.logger.debug(e),this.valueInMove[t]=this.values[t],this.valueInMove[t+1]=this.values[t+1]}),e.register("view/bar:mousemove",(e,i,s)=>{t("bar-mousemove",10,()=>{this.logger.debug("JSR: Bar mousemove."),this.logger.debug(e),this._setValue(s,i,!0),this._setValue(s,i+1,!0)})}),e.register("view/bar:mouseup",e=>{this.logger.debug("JSR: Bar mouseup."),this.logger.debug(e)})}build({config:e,modules:t,logger:i}){this.config=e,this.logger=i,this.modules=t,this.limit={},this.setLimit("min",this.config.limit.min,!0),this.setLimit("max",this.config.limit.max,!0),this.stepDecimals=r(this.config.step),this.stepRatio=function(){const e=this.config.min,t=this.config.max;return this.config.step/(t-e)}.call(this),this.stepRatioDecimals=r(this.stepRatio)}init(e,t){this.modules.renderer.appendRoot(e[0]),t.forEach((e,t)=>{e=n.call(this,e),this._setValue(e,t)}),this._bindEvents(),this.logger.info("JSR: Core initiated.")}getValue(e){const t=this.values[e];return o.call(this,t)}setValue(e,t){this._setValue(e,t)}setLimit(e,t,i=!1){if(null===t||void 0===t)this.limit[e]="min"===e?0:1;else{if(this.limit[e]=n.call(this,t),this.limit[e]<0?this.limit[e]=0:this.limit[e]>1&&(this.limit[e]=1),i)return;if(this.values.forEach((e,t)=>{this._setValue(e,t)}),this.config.limit.show){const e=this.modules.renderer.body.limitBar;e.style.left=`${100*this.limit.min}%`,e.style.right=`${100*(1-this.limit.max)}%`}}}}};var a=function(e,t){const i={};return function e(t,i,s,r){const n=i[t],o=n.count,l=[];if(o<=0)return l;s[t]=s[t]||[];for(let e=0;e<o;e+=1){const e=document.createElement("div");e.classList.add(...n.classes),s[t].push(e),l.push(e)}return n.children.length>0&&n.children.forEach(n=>{for(let l=0;l<o;l+=1)e(n,i,s,r).forEach(e=>{r[n]=void 0===r[n]?0:r[n]+1,e.dataset.jsrId=r[n];for(const t in i[n].attributes)e.setAttribute(t,i[n].attributes[t]);s[t][l].appendChild(e)})}),l}(t,e,i,{}),function(e,t){for(const i in e)1!==e[i].length||t[i].alwaysArray||(e[i]=e[i][0])}(i,e),i};var h={name:"renderer",Klass:class{constructor(){this.logger=null,this.config={},this.modules={},this.temp={sliderInMove:null,sliderClickX:0,barInMove:null,barClickX:0},this.values=[],this.body={},this.bodyStructure={root:{classes:["jsr"],children:["railOuter"],count:1},railOuter:{classes:["jsr_rail-outer"],children:["rail"],count:1},rail:{classes:["jsr_rail"],children:["bars","sliders","limitBar"],count:1},sliders:{classes:["jsr_slider"],children:[],attributes:{tabindex:0},count:2,alwaysArray:!0},bars:{classes:["jsr_bar"],children:[],count:1,alwaysArray:!0},limitBar:{classes:["jsr_bar","jsr_bar--limit"],children:[],count:1}}}_bindEvents(){const e=this.modules.eventizer;s(this.body.sliders,"click",e=>{e.stopPropagation()}),s(this.body.sliders,"mousedown",t=>{t.stopPropagation(),this.temp.sliderInMove=parseInt(t.target.dataset.jsrId),this.temp.sliderClickX=t.clientX;const i=function(e){const t=[];return this.values.forEach((i,s)=>{i===this.values[e]&&t.push(s)}),t}.call(this,this.temp.sliderInMove);i.length>1&&(this.temp.sliderInMove=i),e.trigger("view/slider:mousedown",t,i)}),s(document,"mousemove",t=>{if(t.stopPropagation(),null===this.temp.sliderInMove)return;this.temp.sliderInMove instanceof Array&&(t.clientX<this.temp.sliderClickX?this.temp.sliderInMove=this.temp.sliderInMove[0]:this.temp.sliderInMove=this.temp.sliderInMove.pop()),this.body.sliders[this.temp.sliderInMove].focus(),this.body.sliders[this.temp.sliderInMove].classList.add("jsr_slider--active");const i=(t.clientX-this.temp.sliderClickX)/this.body.railOuter.offsetWidth;e.trigger("view/slider:mousemove",t,this.temp.sliderInMove,i)}),s(document,"mouseup",t=>{null!==this.temp.sliderInMove&&(this.body.sliders.forEach(e=>{e.classList.remove("jsr_slider--active")}),e.trigger("view/slider:mouseup",t,this.temp.sliderInMove),this.temp.sliderInMove=null)}),s(this.body.railOuter,"mouseup",t=>{if(this.temp.barIsMoved)return;const i=(t.clientX-this.body.railOuter.getBoundingClientRect().left)/this.body.railOuter.offsetWidth;e.trigger("view/rail:click",t,i)}),this.body.bars&&(s(this.body.bars,"mousedown",t=>{this.temp.barInMove=parseInt(t.target.dataset.jsrId),this.temp.barClickX=t.clientX,e.trigger("view/bar:mousedown",t,this.temp.barInMove)}),s(document,"mousemove",t=>{if(null===this.temp.barInMove)return;this.temp.barIsMoved=!0;const i=(t.clientX-this.temp.barClickX)/this.body.railOuter.offsetWidth;e.trigger("view/bar:mousemove",t,this.temp.barInMove,i)}),s(document,"mouseup",t=>{null!==this.temp.barInMove&&(e.trigger("view/bar:mouseup",t,this.temp.barInMove),this.temp.barInMove=null,this.temp.barIsMoved=!1)})),s(this.body.root,"keydown",t=>{const i=t.target.dataset.jsrId,s={37:-1,38:1,39:1,40:-1}[t.keyCode.toString()];if(!s)return!1;t.preventDefault(),e.trigger("view/root:arrow",t,i,s)})}_updateBars(e,t){if(!this.body.bars)return;const i=this.body.bars[e-1],s=this.body.bars[e];i&&(i.style.right=`${100*(1-t)}%`),s&&(s.style.left=`${100*t}%`)}build({modules:e,logger:t,config:i}){0===Object.keys(this.body).length&&(this.modules=e,this.logger=t,this.config=i,this.bodyStructure.sliders.count=this.config.sliders||1,this.bodyStructure.bars.count=this.bodyStructure.sliders.count-1,this.body=a(this.bodyStructure,"root"),this._bindEvents()),this.modules.eventizer.trigger("modules/renderer:builded")}get structure(){return this.bodyStructure}appendRoot(e){e.parentNode.insertBefore(this.body.root,e.nextSibling),this.modules.eventizer.trigger("modules/renderer:rootAppended")}setSliderValue(e,t){const i=this.body.sliders[t],s=`${100*e}%`;this.logger.debug(`JSR: Slider no. ${t} set to value: ${e}.`),this.values[t]=e,i.style.left=s,this._updateBars(t,e)}}},u=class{constructor(e){this.callback=e,this.enabled=!0}disable(){this.enabled=!1}enable(){this.enabled=!0}trigger(...e){this.enabled&&this.callback(...e)}};var d={name:"eventizer",Klass:class{constructor(){this.store={}}_createNewStore(e){this.store[e]||(this.store[e]=[])}_addListener(e,t){this._createNewStore(e);const i=new u(t);return this.store[e].push(i),i}_dispatchEvent(e,...t){if(!this.store[e])return!1;const i=this.store[e].length;for(let s=0;s<i;s+=1)this.store[e][s].trigger(...t)}register(e,t){return this._addListener(e,t)}trigger(e,...t){this._dispatchEvent(e,...t)}}};const c={debug:0,info:1,warn:2,error:3,disable:4};var g={name:"inputUpdater",Klass:class{constructor(){this.input=null}_bindEvents(){this.modules.eventizer.register("core/value:update",(e,t)=>{this.inputs[e].value=t,this.modules.eventizer.trigger("input/value:update",this.inputs[e],t),this.logger.debug(`JSR: Input ${e} updated with value ${t}`)})}build({config:e,modules:t,logger:i},s){this.inputs=s.inputs,this.logger=i,this.config=e,this.modules=t,this._bindEvents()}}},m=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===f}(e)}(e)};var f="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function b(e,t){var i;return t&&!0===t.clone&&m(e)?p((i=e,Array.isArray(i)?[]:{}),e,t):e}function v(e,t,i){var s=e.slice();return t.forEach(function(t,r){void 0===s[r]?s[r]=b(t,i):m(t)?s[r]=p(e[r],t,i):-1===e.indexOf(t)&&s.push(b(t,i))}),s}function p(e,t,i){var s=Array.isArray(t);return s===Array.isArray(e)?s?((i||{arrayMerge:v}).arrayMerge||v)(e,t,i):function(e,t,i){var s={};return m(e)&&Object.keys(e).forEach(function(t){s[t]=b(e[t],i)}),Object.keys(t).forEach(function(r){m(t[r])&&e[r]?s[r]=p(e[r],t[r],i):s[r]=b(t[r],i)}),s}(e,t,i):b(t,i)}p.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce(function(e,i){return p(e,i,t)})};var y=p;function M(e,t){this.mergedLabels.push(t),this.labels[e].appendChild(this.labels[t])}function w(){const e=this.labels;(function(){this.mergedLabels.forEach(e=>{this.labelsParent.appendChild(this.labels[e])}),this.mergedLabels=[]}).call(this);let t=0,i=t+1;for(;i<e.length;)e[t].getBoundingClientRect().right+5>=e[i].getBoundingClientRect().left?(M.call(this,t,i),i+=1):(t+=1,i+=1);this.minMax[0].getBoundingClientRect().right+5>=this.labels[0].getBoundingClientRect().left?this.minMax[0].style.opacity="0":this.minMax[0].style.opacity="1",this.labels[this.labels.length-1].getBoundingClientRect().right+5>=this.minMax[1].getBoundingClientRect().left?this.minMax[1].style.opacity="0":this.minMax[1].style.opacity="1"}var _={name:"labels",Klass:class{constructor(){this.labels=[],this.minMax=[],this.values=[],this.labelsParent=null,this.mergedLabels=[]}_bindEvents(){s(this.labels,"click",e=>{e.stopPropagation()}),this.modules.eventizer.register("core/value:update",(e,t,i)=>{this.values[e]=[t,i],function(e,t,i){const s=this.labels[e];if(this.config.step<1){const e=r(t),i=r(this.config.step)-e;if(i>0){const e=t.toString().split(".");t=`${e[0]}.${e[1]||0}${Array(i).join("0")}`}}s.innerHTML=this.formatter?this.formatter(t):t,this.values[e]=i;let n=s.getBoundingClientRect();s.style.left=`calc(${100*i}% - ${n.width/2}px)`,function(){return this.values.filter(e=>void 0!==e).length===this.config.values.length}.call(this)&&w.call(this);const o=this.modules.renderer.body.root.getBoundingClientRect();(n=s.getBoundingClientRect()).right>o.right&&(s.style.left=`calc(100% - ${n.width}px)`),n.left<o.left&&(s.style.left="0")}.call(this,e,t,i)}),s(this.labels,"mousedown",e=>{const t=new MouseEvent("mousedown",e);this.modules.renderer.body.sliders[e.target.dataset.jsrId].dispatchEvent(t)}),s(window,"resize",()=>{t(`label-update-overlapping-${Math.random()}`,100,()=>{w.call(this)})})}_parseMinMax(){this.minMax[0].innerHTML=this.formatter?this.formatter(this.config.min):this.config.min,this.minMax[1].innerHTML=this.formatter?this.formatter(this.config.max):this.config.max,this.minMax[0].style.left="0%",this.minMax[1].style.right="0%",this.config.labels.minMax||(this.minMax[0].style.display="none",this.minMax[1].style.display="none")}build({config:e,modules:t,logger:i}){this.logger=i,this.config=y({labels:{minMax:!0,formatter:null}},e),this.modules=t,this.formatter=this.config.labels.formatter,this.modules.renderer.structure.labels={classes:["jsr_label"],children:[],count:this.config.sliders,alwaysArray:!0},this.modules.renderer.structure.rail.children.push("labels"),this.modules.renderer.structure.labelsMinMax={classes:["jsr_label","jsr_label--minmax"],children:[],count:2},this.modules.renderer.structure.rail.children.push("labelsMinMax"),this.modules.eventizer.register("modules/renderer:builded",()=>{this.labels=this.modules.renderer.body.labels,this.labelsParent=this.labels[0].parentNode,this.minMax=this.modules.renderer.body.labelsMinMax,this._parseMinMax(),this._bindEvents()})}}};var x={name:"touchSupport",Klass:class{_bindEvents(){const e=[this.modules.renderer.body.sliders];this.modules.renderer.body.labels&&e.push(this.modules.renderer.body.labels),s(e,"touchstart",e=>{document.documentElement.classList.add("jsr_lockscreen"),e=e.targetTouches.item(0);const t=new MouseEvent("mousedown",e);this.modules.renderer.body.sliders[e.target.dataset.jsrId].dispatchEvent(t)}),s(e,"touchmove",e=>{e=e.targetTouches.item(0);const t=new MouseEvent("mousemove",e);document.dispatchEvent(t)}),s(document,"touchend",e=>{document.documentElement.classList.remove("jsr_lockscreen"),e=e.targetTouches.item(0);const t=new MouseEvent("mouseup",e);document.dispatchEvent(t)})}build({config:e,modules:t,logger:i}){this.logger=i,this.config=e,this.modules=t,this._bindEvents()}}};var E={name:"htmlLabels",Klass:class{_bindEvents(){this.inputs.map(e=>e.id).forEach((e,t)=>{const i=document.querySelector(`label[for="${e}"]`);i&&i.addEventListener("click",()=>{this.modules.renderer.body.sliders[t].focus()})})}build({config:e,modules:t,logger:i},s){this.logger=i,this.config=e,this.modules=t,this.inputs=s.inputs,this._bindEvents()}}};var S={name:"grid",Klass:class{_bindEvents(){const e=Math.random();window.addEventListener("resize",()=>{t(`grid-resize-${e}`,50,()=>{this.logger.debug("JSR: Canvas resized."),this._setDimensions(),this._render()})})}_setDimensions(){this.width=this.modules.renderer.body.railOuter.offsetWidth,this.height=this.config.grid.height+this.config.grid.fontSize+this.config.grid.textPadding,this.devicePixelRatio=window.devicePixelRatio||1,this.canvas.style.width=`${this.width}px`,this.canvas.width=this.width*this.devicePixelRatio,this.canvas.style.height=`${this.height}px`,this.canvas.height=this.height*this.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio)}_getNumberOfLines(){return Math.round(100)}_render(){this._setDimensions();const e=this.width,t=this.config.grid.height,i=this.context,s=this._getNumberOfLines(),r=1/s;i.clearRect(0,0,e,t),i.beginPath(),i.lineWidth=1,i.fillStyle=i.strokeStyle=this.config.grid.color,i.font=`${this.config.grid.fontSize}px ${this.config.grid.fontFamily}`,i.textBaseline="top";for(let n=0;n<=s;n+=1){let o=n*r*e;if(o=Math.round(100*o)/100,i.moveTo(o,0),i.lineTo(o,t),n%10==0){i.textAlign=0===n?"left":n===s?"right":"center";let o=(this.config.max-this.config.min)*(n/s)+this.config.min;this.config.labels&&this.config.labels.formatter&&(o=this.config.labels.formatter(o)),i.fillText(o.toString(),n*r*e,t+this.config.grid.textPadding)}}i.closePath(),i.stroke()}build({config:e,modules:t,logger:i}){this.logger=i,this.config=y({grid:{color:"rgba(0, 0, 0, 0.3)",height:10,fontSize:10,fontFamily:"sans-serif",textPadding:5}},e),this.modules=t,this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.classList.add("jsr_canvas"),this.context=this.canvas.getContext("2d")),this.modules.eventizer.register("modules/renderer:rootAppended",()=>{1===this.modules.renderer.body.railOuter.childElementCount&&this.modules.renderer.body.railOuter.appendChild(this.canvas),this._setDimensions(),this._render()}),this._bindEvents()}}};return class{constructor(e,t={}){const i={log:"error",min:0,max:100,step:1,enabled:!0,limit:{show:!1},modules:{},modulesArray:[d,l,_,S,h,x,g,E]};this.config=y(i,t),this.specificConfig={inputUpdater:{},htmlLabels:{}},this.logger=new class{constructor(){this.level=1}setLevel(e){this.level=c[e]}debug(...e){this.level>0||console.log(...e)}log(...e){this.level>1||console.log(...e)}info(...e){this.level>1||console.info(...e)}warn(...e){this.level>2||console.warn(...e)}error(...e){this.level>3||console.error(...e)}},this.logger.setLevel(this.config.log),e=[].concat(e),this.inputs=e.map(e=>"string"==typeof e?document.querySelector(e):e);const s=this._validate({inputs:e});if(s)return s.forEach(e=>{this.logger.error(e)}),{};this.modules={},this.config.modulesArray.forEach(e=>{(void 0===this.config.modules[e.name]||this.config.modules[e.name])&&(this.modules[e.name]=new e.Klass)}),this.specificConfig.inputUpdater.inputs=this.inputs,this.specificConfig.htmlLabels.inputs=this.inputs,this._buildModules(),this._init()}_validate(e){const t=[];return this.config.sliders!==this.config.values.length&&t.push("JSR: Number of sliders isn't equal to number of values."),this.inputs.length!==this.config.values.length&&t.push("JSR: Number of inputs isn't equal to number of values."),this.inputs.forEach((i,s)=>{i||t.push(`JSR: Input ${e.inputs[s]} not found.`)}),!!t.length&&t}_buildModules(){for(const e in this.modules){const t=this.modules[e].build;t?(t.call(this.modules[e],{modules:this.modules,logger:this.logger,config:this.config},this.specificConfig[e]||{}),this.logger.info(`JSR: Module ${e} builded.`)):this.logger.info(`JSR: Module ${e} skipped. No .build() method.`)}}_init(){this.inputs.forEach(e=>{e.style.display="none"}),this.modules.core.init(this.inputs,this.config.values)}addEventListener(e,t){return this.modules.eventizer.register({update:"input/value:update"}[e],t),this}setValue(e,t){return this.modules.core.setValue(t,e),this}setLimit(e,t){return this.modules.core.setLimit(e,t),this}redraw(e){this.config=y(this.config,e),this._buildModules(),this._init()}disable(){return this.config.enabled=!1,this.modules.renderer.body.root.classList.add("jsr--disabled"),this}enable(){return this.config.enabled=!0,this.modules.renderer.body.root.classList.remove("jsr--disabled"),this}}});
